import{c$ as b,e as w,d0 as k,H as v,g as m,d1 as I,d2 as h,d3 as g,d4 as S,N as x,d5 as E,c5 as M,d6 as O,d7 as $}from"./index-7LVg-iY6.js";const F={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function J(s){var a;const o=s.folders||[],e=o.slice(),r=new Map,i=new Map,u=new Map,y=new Map,c=new Map,f={esriGeometryPoint:i,esriGeometryPolyline:u,esriGeometryPolygon:y};(((a=s.featureCollection)==null?void 0:a.layers)||[]).forEach(t=>{const d=m(t);d.featureSet.features=[];const l=t.featureSet.geometryType;r.set(l,d);const p=t.layerDefinition.objectIdField;l==="esriGeometryPoint"?G(i,p,t.featureSet.features):l==="esriGeometryPolyline"?G(u,p,t.featureSet.features):l==="esriGeometryPolygon"&&G(y,p,t.featureSet.features)}),s.groundOverlays&&s.groundOverlays.forEach(t=>{c.set(t.id,t)}),o.forEach(t=>{t.networkLinkIds.forEach(d=>{const l=N(d,t.id,s.networkLinks);l&&e.push(l)})}),e.forEach(t=>{var d;if(t.featureInfos){t.points=m(r.get("esriGeometryPoint")),t.polylines=m(r.get("esriGeometryPolyline")),t.polygons=m(r.get("esriGeometryPolygon")),t.mapImages=[];for(const l of t.featureInfos)switch(l.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const p=f[l.type].get(l.id);p&&((d=t[F[l.type]])==null||d.featureSet.features.push(p));break}case"GroundOverlay":{const p=c.get(l.id);p&&t.mapImages.push(p);break}}t.fullExtent=P([t])}});const n=P(e);return{folders:o,sublayers:e,extent:n}}function T(s,o,e,r){var y;const i=(y=w)==null?void 0:y.findCredential(s);s=b(s,{token:i==null?void 0:i.token});const u=k.kmlServiceUrl;return v(u,{query:{url:s,model:"simple",folders:"",refresh:e!==0||void 0,outSR:JSON.stringify(o)},responseType:"json",signal:r})}function j(s,o,e=null,r=[]){const i=[],u={},y=o.sublayers,c=new Set(o.folders.map(f=>f.id));return y.forEach(f=>{var a;const n=new s;if(e?n.read(f,e):n.read(f),r.length&&c.has(n.id)&&(n.visible=r.includes(n.id)),u[f.id]=n,f.parentFolderId!=null&&f.parentFolderId!==-1){const t=u[f.parentFolderId];t.sublayers||(t.sublayers=[]),(a=t.sublayers)==null||a.unshift(n)}else i.unshift(n)}),i}function G(s,o,e){e.forEach(r=>{s.set(r.attributes[o],r)})}function L(s,o){let e;return o.some(r=>r.id===s&&(e=r,!0)),e}function N(s,o,e){const r=L(s,e);return r&&(r.parentFolderId=o,r.networkLink=r),r}async function q(s,o,e,r){const i=s[o];if(!i)return[];const u=M.fromJSON(i.featureSet).features,y=i.layerDefinition,c=O(y.drawingInfo.renderer),f=$.fromJSON(i.popupInfo),n=[];for(const a of u){const t=await c.getSymbolAsync(a);a.symbol=t,a.popupTemplate=f,a.visible=!0;const d=e.sublayerById.get(r);a.origin=d.origin,n.push(a)}return n}function P(s){var r,i,u,y,c,f;const o=I(h),e=I(h);for(const n of s){if((i=(r=n.polygons)==null?void 0:r.featureSet)!=null&&i.features)for(const a of n.polygons.featureSet.features)g(o,a.geometry),S(e,o);if((y=(u=n.polylines)==null?void 0:u.featureSet)!=null&&y.features)for(const a of n.polylines.featureSet.features)g(o,a.geometry),S(e,o);if((f=(c=n.points)==null?void 0:c.featureSet)!=null&&f.features)for(const a of n.points.featureSet.features)g(o,a.geometry),S(e,o);if(n.mapImages)for(const a of n.mapImages)g(o,a.extent),S(e,o)}return E(e,h)?void 0:{xmin:e[0],ymin:e[1],zmin:e[2],xmax:e[3],ymax:e[4],zmax:e[5],spatialReference:x.WGS84}}export{P as I,j as S,q as b,J as d,T as g};
