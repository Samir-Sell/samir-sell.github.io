import{I as c,a4 as m,H as u,bI as p,cc as f,cb as y}from"./index-Cv0-fPI4.js";import{t as v,r as P}from"./query-BurU-78t.js";import{v as g}from"./PivotQuery-fdkBhCT_.js";import"./pbfQueryUtils-6vaooj-7.js";import"./pbf-BdgP76zG.js";import"./memoryEstimations-djtQljaD.js";import"./OptimizedFeature-BV9bW67H.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./queryZScale-Hrs_mNhO.js";function l(r){const t=P(r),o=t.outPivots;if(o!=null&&o.length){for(const i of o)i.pivotType==="Pivot"&&i.pivotParameters.outStatistic?i.pivotParameters.outStatistic=JSON.stringify(i.pivotParameters.outStatistic):i.pivotType==="Unpivot"&&(i.unPivotParameters.sourceFields=i.unPivotParameters.sourceFields.join(","));t.outPivots=JSON.stringify(o)}return t}async function S(r,t,o){return await q(r,t,o)}async function q(r,t,o={}){const i=typeof r=="string"?c(r):r,n=t.geometry?[t.geometry]:[],e=await m(n,null,{signal:o.signal}),a=e==null?void 0:e[0];a!=null&&((t=t.clone()).geometry=a);const s=v({...i.query,f:"json",...l(t)});return u(p(i.path,"queryPivot"),{...o,query:{...s,...o.query}})}async function x(r,t,o){const i=f(r),n={...o},{data:e}=await S(i,g.from(t),n);return y.fromJSON(e)}export{x as executePivotQuery};
