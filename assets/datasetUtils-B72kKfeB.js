import{ag as L,a2 as R,Z as p,a0 as T,j7 as M,a1 as j,cs as _,id as z,az as J}from"./index-MBf2dn39.js";var C;let D=C=class extends L{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new C({variableName:this.variableName,dimensionName:this.dimensionName,values:R(this.values),isSlice:this.isSlice})}};p([T({type:String,json:{write:!0}})],D.prototype,"variableName",void 0),p([T({type:String,json:{write:!0}})],D.prototype,"dimensionName",void 0),p([T({type:M.array(M.oneOf([M.native(Number),M.array(M.native(Number))])),json:{write:!0}})],D.prototype,"values",void 0),p([T({type:Boolean,json:{write:!0}})],D.prototype,"isSlice",void 0),D=C=p([j("esri.layers.support.DimensionalDefinition")],D);function k(e,n,i){var a;const l=n.shift();if(i.length===0){const s=[];i.push({sliceId:-1,multidimensionalDefinition:s})}const t=i.length;for(let s=0;s<t;s++){const m=i.shift().multidimensionalDefinition;(a=l.values)==null||a.forEach(o=>{i.push({sliceId:-1,multidimensionalDefinition:[...m,{variableName:e,dimensionName:l.name,values:[o]}]})})}n.length&&k(e,n,i)}function Q(e,n){const i=[];let l=0;return(n?e.variables.filter(t=>t.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((t,a)=>t.name>a.name?1:-1)).forEach(t=>{const a=[],s=[...t.dimensions].sort((m,o)=>m.name>o.name?-1:1);k(t.name,s,a),a.forEach(m=>{i.push({...m,sliceId:l++})})}),i}function W(e,n,i){let l=e;if(n&&(n=[...n].sort((t,a)=>t.dimensionName<a.dimensionName?-1:1)).forEach(({dimensionName:t,values:a,isSlice:s})=>{a.length&&(l=l.filter(m=>{const o=m.multidimensionalDefinition.find(u=>u.dimensionName===t);if(o==null)return!1;const r=o.values[0];return typeof r=="number"?typeof a[0]=="number"?a.includes(r):a.some(u=>u[0]<=r&&u[1]>=r):typeof a[0]=="number"?a.some(u=>r[0]<=u&&r[1]>=u):s?a.some(u=>u[0]===r[0]&&u[0]===r[1]):a.some(u=>u[0]>=r[0]&&u[0]<=r[1]||u[1]>=r[0]&&u[1]<=r[1]||u[0]<r[0]&&u[1]>r[1])}))}),l.length&&(i==null?void 0:i.start)!=null&&i.end!=null){const t=i.start.getTime(),a=i.end.getTime(),s=l[0].multidimensionalDefinition.findIndex(m=>m.dimensionName==="StdTime");s>-1&&(l=l.filter(m=>{const o=m.multidimensionalDefinition[s].values[0];return t<=o&&a>=o}))}return l.map(t=>t.sliceId)}function F(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function B(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function Y(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function I(e,n,i){var s,m;if(!((s=n==null?void 0:n.subsetDefinitions)!=null&&s.length))return e;let l;if(i){const{variables:o}=n;if(o.length&&!o.includes(i))return null;const r=n.subsetDefinitions.find(u=>u.dimensionName===e.name&&u.variableName===i);if(!((m=r==null?void 0:r.values)!=null&&m.length))return e;l=Y(r.values)}else{const o=n.dimensions.find(({name:r})=>r===e.name);l=o==null?void 0:o.extent}const t=l;if(!(t!=null&&t.length))return e;const a=e.values.filter(o=>F(o,t));return{...e,extent:[...t],values:a}}function S(e,n,i){var t;if(!((t=n==null?void 0:n.subsetDefinitions)!=null&&t.length))return!1;const{variables:l}=n;if(l.length&&e.some(({variableName:a})=>a&&!l.includes(a)))return!0;for(let a=0;a<e.length;a++){const s=e[a],m=n.subsetDefinitions.find(o=>(s.variableName===""||o.variableName===s.variableName)&&o.dimensionName===s.dimensionName);if(m!=null&&m.values.length){const o=Y(m.values);if(!s.isSlice&&s.values.length===2&&!Array.isArray(s.values[0])&&s.values[0]!==s.values[1]&&i){if(!B(s.values,o))return!0}else if(s.values.some(r=>!F(r,o)))return!0}}return!1}function X(e,n){if(e==null)return{isOutside:!1};const{geometry:i,timeExtent:l,multidimensionalDefinition:t}=n;let a=null;if(l!=null&&(a=V(e,l),a==null))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&i){const m=P(i);if(m&&!s.contains(m))return{isOutside:!0}}return t!=null&&t.length&&S(t,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:i,timeExtent:a,multidimensionalDefinition:t}}}function P(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":{const n=z(e);return n?J.fromJSON(n):null}}return null}function V(e,n){const i=e.dimensions.find(({name:s})=>s==="StdTime");if(i==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:l,end:t}=n.toJSON(),a=l===t?[l]:l!=null&&t!=null?[l,t]:[l??t];return a.length===2&&(i!=null&&i.extent.length)&&(a[0]=Math.max(a[0],i.extent[0]),a[1]=Math.min(a[1],i.extent[1]??i.extent[0]),a[1]<a[0])||S([new D({variableName:"",dimensionName:"StdTime",isSlice:a.length===1,values:a})],e,!0)?null:(n.start=new Date(a[0]),n.end=new Date(a[1]??a[0]),n)}function ee(e){var s,m,o;const{rasterInfo:n,multidimensionalSubset:i}=e,{multidimensionalInfo:l}=n;if(l==null)return null;let t=(s=e.multidimensionalDefinition)!=null&&s.length?e.multidimensionalDefinition:U(n,{multidimensionalSubset:i});if(!(t!=null&&t.length))return null;if(t.some(r=>!r.dimensionName)){const{variableName:r}=t[0],u=U(n,{multidimensionalSubset:i,variableName:r});u==null||u.forEach(f=>{var b;const d=t==null?void 0:t.find(({dimensionName:w})=>w===f.dimensionName);(b=d==null?void 0:d.values)!=null&&b.length&&(f.values=d.values,f.isSlice=d.isSlice)}),t=u}const{timeExtent:a}=e;if(t!=null&&a!=null&&(a.start!=null||a.end!=null)){t=t.map(v=>v.clone());const r=(o=(m=l.variables.find(({name:v})=>v===t[0].variableName))==null?void 0:m.dimensions)==null?void 0:o.find(({name:v})=>v==="StdTime"),u=t.find(({dimensionName:v})=>v==="StdTime");if(!r||!u)return null;const{start:f,end:d}=a,b=f==null?null:f.getTime(),w=d==null?null:d.getTime(),h=b??w,g=w??b;if(r.values!=null){const v=r.values.filter(c=>{if(Array.isArray(c)){if(h===g)return c[0]<=h&&c[1]>=h;const y=c[0]<=h&&c[1]>h||c[0]<g&&c[1]>=g,N=c[0]>=h&&c[1]<=g||c[0]<h&&c[1]>g;return y||N}return h===g?c===h:c>=h&&c<=g});if(v.length){const c=v.sort((y,N)=>{const x=Array.isArray(y)?y[0]:y,O=Array.isArray(y)?y[1]:y,E=Array.isArray(N)?N[0]:N,$=Array.isArray(N)?N[1]:N;return h===g?x-E:Math.abs(O-g)-Math.abs($-g)})[0];u.values=[c]}else t=null}else if(r.hasRegularIntervals&&r.extent){const[v,c]=r.extent;h>c||g<v?t=null:u.values=h===g?[h]:[Math.max(v,h),Math.min(c,g)]}}return t!=null&&S(t,i)?null:t}function Z(e,n={}){var u,f;const{multidimensionalInfo:i,keyProperties:l}=e;if(i==null)return null;const{variableName:t,multidimensionalSubset:a,multidimensionalDefinition:s}=n,m=s!=null?(u=s[0])==null?void 0:u.variableName:null,o=t||m||(l==null?void 0:l.DefaultVariable);let{variables:r}=i;return(f=a==null?void 0:a.variables)!=null&&f.length&&(r=r.filter(({name:d})=>a.variables.includes(d))),o?r.find(({name:d})=>d===o)??r[0]:r[0]}function U(e,n={}){const i=Z(e,n);if(!i)return null;const l=[],{dimensions:t,name:a}=i;if(t.length===0)return[new D({variableName:a,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<t.length;s++){const m=I(t[s],n.multidimensionalSubset,a);if(!m)return null;const{values:o,extent:r}=m;let u=(o==null?void 0:o[0])??(r==null?void 0:r[0]);m.name.toLowerCase()==="stdz"&&!m.hasRanges&&r&&Math.abs(r[1])<=Math.abs(r[0])&&(u=o!=null&&o.length?o[o.length-1]:r[1]),l.push(new D({variableName:a,dimensionName:m.name,values:[u],isSlice:!n.useRangeForRangedDimensionInfo||!!m.hasRanges}))}return l}function ne(e){return!!(e!=null&&e.length)&&e.some(n=>{if(n.values==null)return!0;const i=n.values.length;return i===0||i>1||!n.isSlice&&Array.isArray(n.values[0])})}function te(e,n){var l;if(n==null||e==null)return null;let i=n.variables.map(t=>({...t}));return(l=e==null?void 0:e.variables)!=null&&l.length&&(i=i.filter(({name:t})=>e.variables.includes(t)),i.forEach(t=>{t.dimensions=t.dimensions.map(a=>I(a,e,t.name)).filter(_)})),i}function q(e,n){var m;const{values:i}=n;if(i!=null&&i.length){const o=Array.isArray(i[0]),r=Array.isArray(e);return o!==r?-1:o&&r?i.findIndex(u=>u[0]===e[0]&&u[1]===e[1]):i.indexOf(e)}const{extent:l}=n;if(Array.isArray(e)||!l||e<l[0]||e>l[1])return-1;const t=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-l[0])/t);const a=l[0];let s=-1;switch(((m=n.intervalUnit)==null?void 0:m.toLowerCase())||"days"){case"seconds":s=Math.round((e-a)/1e3/t);break;case"minutes":s=Math.round((e-a)/6e4/t);break;case"hours":s=Math.round((e-a)/36e5/t);break;case"days":s=Math.round((e-a)/864e5/t);break;case"months":{const o=new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear(),r=new Date(a).getUTCMonth(),u=new Date(e).getUTCMonth();s=o===0?u-r:u+11-r+12*(o-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/t);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(a).getUTCFullYear())/10/t)}return s}function A(e){var s,m;let n=(s=e.values)==null?void 0:s.length;if(n)return n;const{extent:i,unit:l}=e,t=e.interval||1,a=i?i[1]-i[0]:0;if(l!=="ISO8601")return Math.round(a/t);switch(((m=e.intervalUnit)==null?void 0:m.toLowerCase())??"seconds"){case"seconds":n=Math.round(a/1e3/t);break;case"minutes":n=Math.round(a/6e4/t);break;case"hours":n=Math.round(a/36e5/t);break;case"days":n=Math.round(a/864e5/t);break;case"months":if(i){const o=new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear(),r=new Date(i[0]).getUTCMonth(),u=new Date(i[1]).getUTCMonth();n=o===0?u-r+1:u+11-r+12*(o-1)+1}else n=0;break;case"years":n=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/t):0;break;case"decades":n=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/10/t):0;break;default:n=0}return n}function ae(e){var a,s;if(((a=e.extent)==null?void 0:a.length)!==2||!e.interval)return[];const{extent:[n,i],interval:l}=e;if(e.unit==="ISO8601"){const m=((s=e.intervalUnit)==null?void 0:s.toLowerCase())??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(m)?G(n,i,l,m):[]}const t=Math.round((i-n)/l);return Array.from({length:t},(m,o)=>o===t-1?i:n+o*l)}function G(e,n,i,l){const t=[];let a=e;const s=new Date(e);for(;a<=n;)switch(t.push(a),l){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*i),a=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+i),a=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+i),a=s.getTime();break;case"days":a+=864e5*i;break;case"hours":a+=36e5*i;break;case"minutes":a+=6e4*i;break;case"seconds":a+=1e3*i}return t.length===1?t[1]=n:t[t.length-1]=n,t}function ie(e,n){let i=0;const l=e[0].variableName,t=[...n.variables].sort((a,s)=>a.name>s.name?1:-1);for(let a=0;a<t.length;a++){const s=t[a],m=[...s.dimensions].sort((u,f)=>u.name>f.name?-1:1);if(s.name!==l){i+=m.map(u=>A(u)).reduce((u,f)=>u*f);continue}const o=m.map(u=>A(u)),r=m.length;for(let u=0;u<r;u++){const f=e.find(b=>b.dimensionName===m[u].name);if(f==null)return null;const d=q(f.values[0],m[u]);if(d===-1)return null;o.shift(),i+=u===r-1?d:d*o.reduce((b,w)=>b*w)}break}return i}function se(e){return Math.round(24*(e-25569)*3600*1e3)}function H(e){return(e==null?void 0:e.datasetFormat)==="Function"}function re(e){return H(e)?e.primaryRasters.rasters:[e]}function le(e,n,i,l){const{x:t,y:a}=n,{x:s,y:m}=i,{xmin:o,xmax:r,ymin:u,ymax:f}=e,{width:d,height:b}=e,w=d/s,h=b/m,g=Math.min(w,h),v=g<=1?0:Math.min(.1,g/100),c=Math.floor((o-t)/s+v),y=Math.floor((a-f)/m+v),N=Math.floor((r-t)/s-v),x=Math.floor((a-u)/m-v);return{ul:{x:c,y},width:l>0&&w<.1?0:N-c+1,height:l>0&&h<.1?0:x-y+1}}export{ie as C,te as D,se as U,W as a,U as b,S as c,X as f,ee as g,le as n,D as p,re as r,Q as s,H as t,Z as v,ae as w,ne as y};
