const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/knowledgeGraphService-hYCtZro-.js","assets/index-Cv0-fPI4.js","assets/index-DZndqy9Z.css","assets/networkEnums-DWdnlzOp.js","assets/GPMessage-DE1gWHcC.js","assets/Relationship-C_t3wdRN.js"])))=>i.map(i=>d[i]);
import{bL as f,M as I,fU as w,_ as E,fW as R,k as q,eC as F,fV as W,fY as J,d0 as L,fZ as V,ax as j,ak as b,f_ as Q,f$ as U,g0 as B}from"./index-Cv0-fPI4.js";import{t as C}from"./arcade-DQ8XD6KE.js";import{o as k,g as P,k as O,z as T,p as D,c as z,l as G,m as Y,w as Z,K as H,U as K}from"./Dictionary-CRh2EHlV.js";import{l as X}from"./portalUtils-Dwfaf_uw.js";import{p as $,n as tt}from"./project-d4AsfFt1.js";import{p as et,a as nt,e as rt,i as at,b as it}from"./Relationship-C_t3wdRN.js";import"./arcadeEnvironment-BmsUswGn.js";import"./Feature-BshlmkBm.js";import"./featureConversionUtils-HUfCD0i2.js";import"./OptimizedFeature-BV9bW67H.js";import"./memoryEstimations-djtQljaD.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./aiServices-CSqhHCyD.js";import"./commonProperties-DHiB1uzW.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-DcnyjFLY.js";import"./WhereClause--eO5j_0m.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./unitConversion-C8AhTt3O.js";import"./number-DuDLp1tj.js";let u=null;async function ot(t){const e=L.geometryServiceUrl??"";if(!e){U()||await V();for(const n of t)n.container[n.indexer]=j(n.container[n.indexer],b.WGS84);return}const r=t.map(n=>n.container[n.indexer]),i=new $({geometries:r,outSpatialReference:b.WGS84}),s=await tt(e,i);for(let n=0;n<s.length;n++){const a=t[n];a.container[a.indexer]=s[n]}}async function A(t,e){const r=new q({portal:t,id:e});return await r.load(),u===null&&(u=await E(()=>import("./knowledgeGraphService-hYCtZro-.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4,5]))),await u.fetchKnowledgeGraph(r.url)}function S(t,e,r,i,s){if(t===null)return null;if(w(t)||F(t))return t;if(G(t)||G(t))return t.toJSDate();if(Y(t))return t.toStorageFormat();if(Z(t))return t.toStorageString();if(H(t)){const n={};for(const a of t.keys())n[a]=S(t.field(a),e,r,i,s),n[a]instanceof W&&s.push({container:n,indexer:a});return n}if(R(t)){const n=t.map(a=>S(a,e,r,i,s));for(let a=0;a<n.length;a++)n[a]instanceof W&&s.push({container:n,indexer:a});return n}return K(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?J(t):t:void 0}function st(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return B(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new f(e,"WrongSpatialReference",null)}function v(t,e){if(!t)return null;const r={};for(const i in t)r[i]=d(t[i],e);return r}function d(t,e){return t===null?null:R(t)?t.map(r=>d(r,e)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:v(t.properties,e)}:t instanceof rt?{graphType:"object",properties:v(t.properties,e)}:t instanceof at?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:v(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(r=>d(r,e)):null}:K(t)?st(t,e):w(t)||F(t)||Q(t)?t:null}function Pt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,r){return t.standardFunctionAsync(e,r,(i,s,n)=>{var c,m;if(k(n,2,2,e,r),n[0]===null)throw new f(e,"PortalRequired",r);if(n[0]instanceof C){const l=P(n[1]);let h;return h=(c=e.services)!=null&&c.portal?e.services.portal:I.getDefault(),A(X(n[0],h),l)}if(w(n[0])===!1)throw new f(e,"InvalidParameter",r);const a=P(n[0]);return A(((m=e.services)==null?void 0:m.portal)??I.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,r){return t.standardFunctionAsync(e,r,async(i,s,n)=>{var x;k(n,2,4,e,r);const a=n[0];if(!O(a))throw new f(e,"InvalidParameter",r);const c=n[1];if(!w(c))throw new f(e,"InvalidParameter",r);u===null&&(u=await E(()=>import("./knowledgeGraphService-hYCtZro-.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5])));let m=null;const l=T(n[2],null);if(!(l instanceof D||l===null))throw new f(e,"InvalidParameter",r);if(l){let o=[];m=S(l,!0,!1,e,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await ot(o)}const h=T(n[3],!1),_=new et({openCypherQuery:c,bindParameters:m,provenanceBehavior:h?"include":"exclude"});(((x=a==null?void 0:a.serviceDefinition)==null?void 0:x.currentVersion)??11.3)>11.2&&(_.outputSpatialReference=e.spatialReference);const M=(await u.executeQueryStreaming(a,_)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await M.read();if(o)break;if(R(p))for(const g of p)y.push(d(g,e));else{const g=[];for(const N of p)g.push(d(p[N],e));y.push(g)}}}catch(o){throw o}return D.convertJsonToArcade(y,z(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Pt as registerFunctions};
