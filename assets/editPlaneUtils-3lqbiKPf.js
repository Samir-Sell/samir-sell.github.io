import{T as he,pU as et,cj as Ct,O as $t,cE as ge,kE as At,D as a,F as l,Z as S,cQ as Ft,cq as Et,eQ as me,dy as Qe,dx as Ke,dZ as tn,d$ as rt,N as ye,pY as en,hf as nn,a0 as on,a9 as fe,cD as ve,$ as sn,ck as rn,dc as I,qf as Lt,df as st,ft as an,cF as U,j as ln,br as nt,ed as cn,cm as un,a7 as at,cf as Nt,hc as Vt,j9 as Ot,aP as _e,n4 as we,cy as xe,du as St,fB as be,jP as pn,oQ as dn,g as jt,j$ as hn,je as L,nd as qt,qg as gn,qh as mn,gd as yn,pB as fn,pC as Bt,dJ as vn,gy as Yt,jv as Wt,e0 as Xt,qc as Jt}from"./index-7LVg-iY6.js";import{r as D,V as _n,R as wn,E as xn,e as bn,H as Pn}from"./rotate-Bl98VDk2.js";import{n as $n}from"./GraphicsLayer-Dt1IdCU8.js";import{W as On,k as Qt,v as Sn,b as Kt,U as Tn,T as Mn,j as te,R as kn}from"./createUtils-B7NSCIhw.js";import{v as ut,c as Cn,a as Pe,T as J,d as R,q as En}from"./quantityUtils-Dj5wk2_C.js";import{c as Vn,y as In,I as $e,U as Oe,x as lt,t as ee,i as Rn,E as Se}from"./elevationInfoUtils-DiH329d2.js";import{h as K,M as Dn,j as Gn,I as Te,b as Me,Q as zn,U as Un,g as Tt,e as Mt,w as Hn,a as Zn,V as An,t as Fn,c as Ln,o as Nn,l as jn}from"./SnappingContext-J_7LfRG3.js";import{R as H,j as ke,U as qn,x as Bn}from"./angularMeasurementUtils-cISMWdP-.js";import{f as Z,C as It,E as Yn,Z as Ce,F as Wn,G as Ee,H as Xn,D as Jn,U as Qn,e as Kn,R as ti,k as ei,g as Ve,I as Ie,J as ni,K as ii}from"./hitTestSelectUtils-DSNbAfYs.js";import{t as oi}from"./ReactiveSet-CkdOQvZR.js";import{c as si}from"./meshVertexSpaceUtils-CVbju_nQ.js";import{x as pt,k as ri}from"./hydratedFeatures-ChoLGmfV.js";import{n as dt,t as Rt}from"./projectVectorToVector-DvpKoIay.js";import{N as ai}from"./geodesicUtils-B4oU4_4k.js";import{z as li,J as ht}from"./boundedPlane-DRvX0Eod.js";import{t as N}from"./vectorStacks-C4W7rb0Q.js";function X(e,t){return e===t||e!=null&&t!=null&&he(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function wt(e,t,n){return e===t||e!=null&&t!=null&&he(e.spatialReference,t.spatialReference)&&et(e.x,t.x,n)&&et(e.y,t.y,n)&&et(e.z??0,t.z??0,n)&&et(e.m??0,t.m??0,n)}const Dt={UndoRedoUpdating:"Cannot perform operation whilst undo redo is updating",UndoInvalidError:"There are no items to Undo",RedoInvalidError:"There are no items to Redo"};class j extends Error{constructor(){super(Dt.UndoRedoUpdating),this.type="undo-redo-updating-error"}}let ci=class extends Error{constructor(){super(Dt.UndoInvalidError),this.type="undo-redo-undo-error"}},ne=class extends Error{constructor(){super(Dt.RedoInvalidError),this.type="undo-redo-redo-error"}},M=class extends Ct{constructor(){super(...arguments),this._stack=new $t,this._stackPosition=-1,this._updatingHandles=new ge}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new ci;if(this.updating)throw new j;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(1),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new ne;if(this.updating)throw new j;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new ne;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new j;await this._updatingHandles.addPromise((async()=>{t.status===0&&await t.executeUndoRedoOperation(0),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(n=>n.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new j;await this._updatingHandles.addPromise((async()=>{t.status===0&&await t.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,n=!1){if(this.updating&&!n)return;await At(()=>!this.updating);const i=new $t;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===t?(s.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new j;await At(()=>!this.updating),this._drainStack()}};a([l()],M.prototype,"_stack",void 0),a([l()],M.prototype,"_stackPosition",void 0),a([l()],M.prototype,"updating",null),a([l({readOnly:!0})],M.prototype,"canUndo",null),a([l({readOnly:!0})],M.prototype,"hasUndo",null),a([l({readOnly:!0})],M.prototype,"canRedo",null),a([l({readOnly:!0})],M.prototype,"hasRedo",null),M=a([S("esri.UndoRedo")],M);let ui=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};function A(e,t,n){if(e==null)return"noTool";switch(e){case"point":return pi();case"multipoint":return"multipoint";case"polyline":return di(t,n);case"polygon":return hi(t,n);case"rectangle":case"circle":return gi(t,n);default:return}}function pi(e){return"point"}function di(e,t){const n=e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0;return t==="freehand"?n<2?"freehandStart":"freehandEnd":n<2?"polylineZeroVertices":"polylineOneVertex"}function hi(e,t){const n=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;if(n<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(n<4)return t==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function gi(e,t){if((e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}function mi(e,t){const n=e==null?void 0:e.geometry;if(!e||(n==null?void 0:n.type)!=="mesh"||!t)return;const{renderCoordsHelper:i,elevationProvider:o}=t,{camera:s}=t.state,{extent:c}=n,{center:r,spatialReference:u}=c,p=Ft(u),d=Et(u),m=Ft(i.spatialReference),v=c.width*p,y=c.height*d,g=(c.zmax??0)*d,_=g-(c.zmin??0)*d,P=Math.max(v,y,_)/m,{x:w,y:x}=r,$=r.z??0;me(it,w,x,$),i.toRenderCoords(it,u,it);const E=P/s.computeScreenPixelSizeAt(it);if(E>Math.min(s.width,s.height)/s.pixelRatio*fi)return"meshTooClose";if(E<yi)return"meshTooFar";const tt=Vn(e),{absoluteZ:ft}=In(w,x,g,u,t,tt);return ft<(o.getElevation(w,x,$,u,"ground")??0)*d+_*vi?"meshUnderground":"mesh"}const yi=20,fi=1,vi=.1,it=Qe();function _i(e,t,n,i,o,s){let c="geodesic",r=ai(n);const u=Z();return It(e,t,i,u),u[2]=0,r&&dt(u,n,u,r)||(c="euclidean",r=n),{mode:c,view:t,elevationInfo:i,hasZ:o,directionMode:s,spatialReference:e.spatialReference,measurementSR:r,origin:u}}function wi(e,t,n){if(t==null||e==null)return;const i=en(n.measurementSR);if(i==null)return;const o=gt(e,n);if(o==null)return;const s=ut(t,i);return new Wn(o,s)}function xi(e,t,n,i){if(n==null||e==null)return;const o=gt(e,i);if(o==null)return;const s=H(n),c=10,r=p=>{if(p==null)return;const d=Z(),m=Cn(p,"degrees","geographic");return qn(d,o,i.measurementSR,c,m,i.mode)?new Jn(o,d):void 0},u=()=>{if(t!=null&&e!=null)return H(ke(t,e))};switch(i.directionMode){case"absolute":return r(s);case"relative":{const p=u();return p==null?void 0:r(p+s)}case"relative-bilateral":{const p=u();return p==null?void 0:Ee([r(p+s),r(p-s)])}}}function Re(e,t){const n=mt(e,t);return n!=null?new Xn(n):void 0}function De(e,t,n){const{context:i,longitude:o,latitude:s,direction:c,distance:r,elevation:u}=n;if(o!=null||s!=null||r!=null||u!=null||c!=null){if(o!=null||s!=null){const p=H(o),d=H(s),m=mt(u,i);return new Ce(p,d,m)}return bi(e,t,n)}}function bi(e,t,{context:n,direction:i,distance:o,elevation:s}){if(t==null)return Re(s,n);const{view:c,elevationInfo:r,measurementSR:u}=n,p=It(t,c,r);if(!u||!dt(p,t.spatialReference,ie,u))return;const[d,m]=ie,v=o!=null?ut(o,"meters"):void 0,y=H(i),g=mt(s,n),_=w=>{const x=new Qn([d,m],u,v,g,w);return v==null||w==null||g==null&&n.hasZ?x:new Kn(x.closestTo(p))};if(y==null)return _(void 0);const P=()=>{if(e!=null&&t!=null)return H(ke(e,t))};switch(n.directionMode){case"absolute":return _(y);case"relative":{const w=P();return w==null?void 0:_(w+y)}case"relative-bilateral":{const w=P();return w==null?void 0:Ee([_(w+y),_(w-y)])}}}function Pi(e){return e.context.mode==="geodesic"?De(null,null,e):Ge(e)}function $i(e,t,n){const{context:i,x:o,y:s,distance:c,direction:r,elevation:u}=n;return i.mode==="geodesic"?De(t,e,n):o!=null||s!=null?Ge(n):Oi([wi(e,c,i),xi(e,t,r,i),Re(u,i)])}function Ge({x:e,y:t,elevation:n,context:i}){ot.x=(e==null?void 0:e.value)??0,ot.y=(t==null?void 0:t.value)??0,ot.spatialReference=i.spatialReference;const o=gt(ot,i,Mi);return new Ce(e!=null&&o!=null?o[0]:void 0,t!=null&&o!=null?o[1]:void 0,mt(n,i))}function Oi(e){let t;for(const n of e)n&&(t=(t==null?void 0:t.intersect(n))??n);return t}function gt(e,t,n=Z()){const{view:i,elevationInfo:o,measurementSR:s,origin:c,mode:r}=t;if(It(e,i,o,n),dt(n,e.spatialReference,n,s))return r!=="geodesic"&&Ke(n,n,c),n}function Si(e,t,n,i){const{view:o,measurementSR:s,spatialReference:c,origin:r,mode:u}=n;if(u==="geodesic"?tn(q,e):rt(q,e,r),dt(q,s,q,c))return Yn(q,o,t,n,i)}function mt(e,t){var n;return((n=Ti(e,t))==null?void 0:n.value)??void 0}function Ti(e,{view:t,origin:n,elevationInfo:i,hasZ:o,measurementSR:s}){if(e==null||!o)return;const c=nn(s);if(c==null)return;const[r,u]=n,p=ut(e,c),d=(t==null?void 0:t.type)==="3d"?$e(t,r,u,p,s,i):p;return d!=null?Pe(d,c):void 0}const ie=Z(),Mi=Z(),q=Z(),ot=Rt(0,0,0,ye.WGS84);let k=class extends D{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=J}get allFields(){return[]}};a([l()],k.prototype,"type",void 0),a([l()],k.prototype,"radius",void 0),a([l()],k.prototype,"xSize",void 0),a([l()],k.prototype,"ySize",void 0),a([l()],k.prototype,"area",void 0),a([l()],k.prototype,"helpMessage",void 0),a([l()],k.prototype,"allFields",null),k=a([S("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],k);let B=class extends K(D){constructor(t){super(t),this.type="draw-mesh",this.orientation=Dn({lockable:!1}),this.scale=Gn({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([l()],B.prototype,"helpMessage",void 0),a([l()],B.prototype,"allFields",null),B=a([S("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],B);let Y=class extends K(D){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],Y.prototype,"helpMessage",void 0),a([l()],Y.prototype,"allFields",null),Y=a([S("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],Y);let W=class extends K(D){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([l()],W.prototype,"helpMessage",void 0),a([l()],W.prototype,"allFields",null),W=a([S("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],W);let G=class extends K(D){constructor(t){super(t),this.type="draw-polygon",this.direction=Te(),this.distance=Me(),this.area=zn(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([l()],G.prototype,"xyMode",void 0),a([l()],G.prototype,"helpMessage",void 0),a([l()],G.prototype,"allFields",null),G=a([S("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],G);let z=class extends K(D){constructor(t){super(t),this.type="draw-polyline",this.direction=Te(),this.distance=Me(),this.totalLength=Un(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([l()],z.prototype,"helpMessage",void 0),a([l()],z.prototype,"xyMode",void 0),a([l()],z.prototype,"allFields",null),z=a([S("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],z);let C=class extends D{constructor(t){super(t),this.type="draw-rectangle",this.xSize=R,this.ySize=R,this.area=J}get allFields(){return[]}};a([l()],C.prototype,"type",void 0),a([l()],C.prototype,"xSize",void 0),a([l()],C.prototype,"ySize",void 0),a([l()],C.prototype,"area",void 0),a([l()],C.prototype,"helpMessage",void 0),a([l()],C.prototype,"allFields",null),C=a([S("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],C);function ki(e,t){return{point:new W({sketchOptions:t,viewType:e}),multipoint:new Y({sketchOptions:t,viewType:e}),polyline:new z({sketchOptions:t,viewType:e}),polygon:new G({sketchOptions:t,viewType:e}),mesh:new B({sketchOptions:t,viewType:e}),rectangle:new C({sketchOptions:t}),circle:new k({sketchOptions:t})}}function oe(e){const{directionOptions:t,geometryType:n,sketchOptions:i,tooltipInfos:o}=e,s=r=>{const u=yt(e).mode,p=o[r].elevation;u==="relative-to-ground"||u==="relative-to-scene"||u==="on-the-ground"?p.lock(Ut(e)):p.unlock()},c=r=>{if(t){const u=o[r].direction;u.committed=t.angle,u.unlockOnVertexPlacement=!1,i.values.directionMode=t.mode}};switch(n){case"polygon":case"polyline":s(n),c(n);break;case"point":case"mesh":s(n)}}function Ci(e,t){const{drawOperation:n,view:i}=t,o=Gt(t),s=yt(t);if(i.type==="2d"||!e||s.mode!=="absolute-height"||(n==null?void 0:n.numCommittedVertices)!==1||!o||o.type!=="draw-polyline"&&o.type!=="draw-polygon"||o.elevation.locked)return;const[c,r,u]=e,p=Li(c,r,u,s,t);p!=null&&o.elevation.lock(p)}function se(e){var t;(t=Gt(e))==null||t.allFields.forEach(n=>{n.unlockOnVertexPlacement&&n.unlock()})}function Gt({geometryType:e,graphic:t,tooltipInfos:n}){var i;return((i=t==null?void 0:t.geometry)==null?void 0:i.type)!==Ei[e]?e==="circle"||e==="rectangle"?n[e]:null:n[e]}const Ei={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline",text:"point"};function Vi(e,t){switch(e==null?void 0:e.type){case"draw-point":Ii(e,t);break;case"draw-multipoint":Ri(e,t);break;case"draw-polyline":Gi(e,t);break;case"draw-polygon":zi(e,t);break;case"draw-rectangle":Hi(e,t);break;case"draw-circle":Zi(e,t);break;case"draw-mesh":Di(e,t)}}function Ii(e,t){var i;const n=(i=t.graphic)==null?void 0:i.geometry;(n==null?void 0:n.type)==="point"&&(zt(e,n,t),e.helpMessage=A("point",n,t.drawOperation.drawingMode))}function Ri(e,t){var i;const n=(i=t.graphic)==null?void 0:i.geometry;(n==null?void 0:n.type)==="multipoint"&&(zt(e,n,t),e.helpMessage=A("multipoint",n,t.drawOperation.drawingMode))}function Di(e,t){const{graphic:n,view:i}=t,o=n==null?void 0:n.geometry;i.type!=="3d"||o&&o.type!=="mesh"||(zt(e,o==null?void 0:o.origin,t),o&&_n(e,o),e.helpMessage=mi(n,i))}function zt(e,t,n){const{drawOperation:i,view:o,sketchOptions:s}=n,{cursorVertex:c}=i;e.sketchOptions=s,e.viewType=o.type;const r=(t==null?void 0:t.type)==="multipoint"?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(r,F(n)),Ue(e.elevation,n),!c)return void(i.constraints=void 0);const u=c;i.constraints={context:Fe(u,n),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function Gi(e,t){const{createOperationGeometry:n,drawOperation:i,automaticLengthMeasurementUtils:o}=t,s=n!=null?n.full:null;s&&s.type!=="polyline"||(ze(e,t),e.totalLength.actual=i.lastVertex?(s?o.autoLength2D(s):null)??R:null,e.helpMessage=A("polyline",s,t.drawOperation.drawingMode))}function zi(e,t){const{createOperationGeometry:n,drawOperation:i}=t,o=n!=null?n.full:null;o&&o.type!=="polygon"||(ze(e,t),e.area.actual=i.lastVertex?(o?t.automaticAreaMeasurementUtils.autoArea2D(o):null)??J:null,e.helpMessage=A("polygon",o,t.drawOperation.drawingMode))}const re=on(fe);function ze(e,t){const{drawOperation:n,sketchOptions:i,view:o,automaticLengthMeasurementUtils:s}=t,{cursorVertex:c,lastVertex:r,secondToLastVertex:u}=n,p=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=o.type;const d=r&&c?s.autoDistanceBetweenPoints2D(re(r),re(c))??R:null;if(e.distance.actual=d,e.distance.readOnly=r==null,e.direction.actual=null,e.direction.readOnly=!0,r&&c&&(p==="absolute"||u)){const y=Bn(u,r,c,p);e.direction.actual=y??En,e.direction.readOnly=!1}e.setLocationFromPoint(c,F(t)),Ue(e.elevation,t);const m=Ui(r,t);e.xyMode=m,e.direction.visible=m==="direction-distance",e.distance.visible=m==="direction-distance",e.effectiveX.visible=m==="coordinates",e.effectiveY.visible=m==="coordinates";const v=c??r;n.constraints=v?{context:Fe(v,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Ui(e,{sketchOptions:t}){const n=t.tooltips.xyMode;return n==="auto"?e?"direction-distance":"coordinates":n}function Hi(e,t){var n;e.sketchOptions=t.sketchOptions,e.xSize=Ze(t),e.ySize=Ae(t),e.area=He(t),e.helpMessage=A("rectangle",(n=t.graphic)==null?void 0:n.geometry,t.drawOperation.drawingMode)}function Zi(e,t){var o;const{forceUniformSize:n,sketchOptions:i}=t;e.sketchOptions=i,e.radius=n?Ai(t):null,e.xSize=n?null:Ze(t),e.ySize=n?null:Ae(t),e.area=He(t),e.helpMessage=A("circle",(o=t.graphic)==null?void 0:o.geometry,t.drawOperation.drawingMode)}function Ue(e,t){const{drawOperation:n}=t,i=(n==null?void 0:n.cursorVertex)??(n==null?void 0:n.lastVertex);e.actual=ei(i)??Ut(t),e.visible=n.hasZ,e.readOnly=!1,e.showAsZ=!0}function He(e){var n;const t=(n=e.createOperationGeometry)==null?void 0:n.full;return(t==null?void 0:t.type)!=="polygon"?J:e.automaticAreaMeasurementUtils.autoArea2D(t)??J}function Ze({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){var i;const n=(i=e==null?void 0:e.rectangle)==null?void 0:i.midpoints;return(n!=null?t.autoDistanceBetweenPoints2D(n.left,n.right):null)??R}function Ae({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){var i;const n=(i=e==null?void 0:e.rectangle)==null?void 0:i.midpoints;return(n!=null?t.autoDistanceBetweenPoints2D(n.top,n.bottom):null)??R}function Ai({createOperationGeometry:e,automaticLengthMeasurementUtils:t}){var n;return(((n=e==null?void 0:e.circle)==null?void 0:n.center)!=null&&e.circle.edge!=null?t.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??R}function Fi(e){const{geometryType:t,tooltipInfos:n}=e;switch(t){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const i=n[t].elevation.committed;return i?ut(i,"meters")/Et(F(e)):void 0}default:return}}function Li(e,t,n,i,o){const{view:s,drawOperation:c}=o;if(s.type!=="3d"||!c)return;n??(n=0);const r=F(o),u=yt(o),p=$e(s,e,t,n,r,u,i);return ti(p,r)??Ut(o)}function yt(e){return e.drawOperation.elevationInfo??Oe}function F(e){return e.drawOperation.coordinateHelper.spatialReference}function Ut(e){const t=Et(F(e));return Pe(e.defaultZ*t,"meters")}function Fe(e,t){return _i(e,t.view,F(t),yt(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}class Ni{constructor(){this._isToolEditable=!0,this._manipulators=new $t,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(t){this._isToolEditable=t}get length(){return this._manipulators.length}add(t,n=0){this.addMany([t],n)}addMany(t,n=0){for(const i of t){const o={manipulator:i,visibilityPredicate:n,attached:!1};this._manipulators.add(o),this._attached&&this._updateManipulatorAttachment(o)}}remove(t){for(let n=0;n<this._manipulators.length;n++)if(this._manipulators.at(n).manipulator===t){const i=this._manipulators.splice(n,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(t=>{this._updateManipulatorAttachment(t)}),this._attached=!0}detach(){this._manipulators.forEach(t=>{this._detachManipulator(t)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:t})=>t.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(t,n){return this._manipulators.on(t,i=>{n(i)})}forEach(t){for(const n of this._manipulators.items)t(n)}some(t){return this._manipulators.items.some(t)}toArray(){const t=[];return this.forEach(n=>t.push(n.manipulator)),t}intersect(t,n){let i=null,o=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:s,attached:c})=>{if(!c||!s.interactive)return;const r=s.intersectionDistance(t,n);r!=null&&r<o&&(o=r,i=s)}),i}_updateManipulatorAttachment(t){this._isManipulatorItemVisible(t)?this._attachManipulator(t):this._detachManipulator(t)}_attachManipulator(t){t.attached||(t.manipulator.attach&&t.manipulator.attach(this._resourceContexts),t.attached=!0)}_detachManipulator(t){if(!t.attached)return;const n=t.manipulator;n.grabbing=!1,n.dragging=!1,n.hovering=!1,n.selected=!1,n.detach&&n.detach(this._resourceContexts),t.attached=!1}_isManipulatorItemVisible(t){return t.visibilityPredicate===2||(this._isToolEditable?t.visibilityPredicate===0:t.visibilityPredicate===1)}}let b=class extends ve{constructor(e){super(e),this.manipulators=new Ni,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationFinishedResolver=sn()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(0)}set editable(e){this.setEditableFlag(0,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}cancel(){this.emit("cancel")}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===0&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){var n;const e=(n=this.view.inputManager.latestPointerInfo)==null?void 0:n.location;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};a([l({constructOnly:!0})],b.prototype,"view",void 0),a([l({readOnly:!0})],b.prototype,"active",null),a([l({value:!0})],b.prototype,"visible",null),a([l({value:!0})],b.prototype,"editable",null),a([l({readOnly:!0})],b.prototype,"manipulators",void 0),a([l({readOnly:!0})],b.prototype,"updating",null),a([l()],b.prototype,"cursor",null),a([l({readOnly:!0})],b.prototype,"automaticManipulatorSelection",void 0),a([l()],b.prototype,"hasFocusedManipulators",null),a([l()],b.prototype,"hasGrabbedManipulators",void 0),a([l()],b.prototype,"hasHoveredManipulators",void 0),a([l()],b.prototype,"firstGrabbedManipulator",void 0),a([l({readOnly:!0})],b.prototype,"created",void 0),a([l({readOnly:!0})],b.prototype,"removeIncompleteOnCancel",void 0),b=a([S("esri.views.interactive.InteractiveToolBase")],b);let f=class extends b{constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new Ve}initialize(){const{view:t}=this;this.internalGraphicsLayer=new $n({listMode:"hide",internal:!0,title:"DrawGraphicTool layer"}),this.view.map.layers.add(this.internalGraphicsLayer);const n=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=ki(t.type,this.sketchOptions);const i=wn(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,oe(this._tooltipsContext),this._coordinateFormatterLoadTask=rn(()=>xn()),this.addHandles([n.on("vertex-add",o=>this.onVertexAdd(o)),n.on("vertex-remove",o=>this.onVertexRemove(o)),n.on("vertex-update",o=>this.onVertexUpdate(o)),n.on("cursor-update",o=>this.onCursorUpdate(o)),n.on("cursor-remove",()=>this._updateGraphic()),n.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>bn(o,this.activeTooltipInfo)),I(()=>this.cursor,o=>{n.cursor=o},st),Lt(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;Vi(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),Lt(()=>{n.constraintZ=Fi(this._tooltipsContext)},an)]),this.finishToolCreation(),n.initializePointer()}destroy(){this.drawOperation=U(this.drawOperation),this.tooltip=U(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=U(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){const{defaultZ:t,directionOptions:n,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:c,sketchOptions:r,tooltipInfos:u,view:p,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:m}=this;return{createOperationGeometry:this._createOperationGeometry,defaultZ:t,directionOptions:n,drawOperation:i,forceUniformSize:o,geometryType:s,graphic:c,sketchOptions:r,tooltipInfos:u,view:p,automaticAreaMeasurementUtils:d,automaticLengthMeasurementUtils:m}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const n=this.drawOperation;n&&(n.drawingMode=t),this._set("mode",t)}get updating(){var t;return((t=this.drawOperation)==null?void 0:t.updating)??!1}get undoRedo(){const{view:{type:t,map:n}}=this;return t==="2d"&&n&&"undoRedo"in n&&n.undoRedo instanceof M?n.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Pn(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&oe(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(T.outline),this.removeHandles(T.regularVertices),this.removeHandles(T.activeVertex),this.removeHandles(T.activeEdge),this.removeHandles(xt)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const n=new ln({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=n,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(n),this.addHandles(this.initializeGraphic(n)),this.notifyChange("graphic"),this.addHandles(nt(()=>{this.internalGraphicsLayer.remove(n),this._graphic===n&&(this._graphic=null)}),xt),n}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){var P,w;if(this.drawOperation==null)return;const{coordinateHelper:n,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:c,geometryIncludingUncommittedVertices:r,numCommittedVertices:u}=this.drawOperation;if(!(u>0||o!=null))return;const p=t.operationComplete?c:r,d=p.length,m=o!=null?n.pointToArray(o):null,v=this._drawSpatialReference,y=i.type==="3d"&&i.viewingMode==="global",g=new ui;g.committedVertices=c,g.cursorVertex=m;const{geometryType:_}=this;switch(_){case"point":case"mesh":g.full=n.arrayToPoint(p[0]);break;case"multipoint":g.full=d>0?kn(p,v):null;break;case"polyline":case"polygon":d>0&&(g.full=_==="polygon"?Mn([p],v,y,!0):te([p],v,y),g.cursorEdge=m!=null&&s&&!X(o,s)?te([[m,n.pointToArray(s)]],v,y):null,g.outline=d>1?g.full:null);break;case"circle":case"rectangle":{if(g.committedVertices=g.cursorVertex=null,!d)break;const x=On(i,p[0]),$=p[0],E=x.makeMapPoint($[0]+ji*i.resolution,$[1]);_==="circle"?d===1&&t.operationComplete?g.circle=Qt([$,E],x,!0):d===2&&(this.forceUniformSize?g.circle=Qt(p,x,this.centered):g.rectangle=Sn(p,x,this.centered)):d===1&&t.operationComplete?g.rectangle=Kt([$,E],x,!0):d===2&&(g.rectangle=this.forceUniformSize?Kt(p,x,this.centered):Tn(p,x,this.centered)),g.full=g.circle!=null?g.circle.geometry:(P=g.rectangle)==null?void 0:P.geometry,g.outline=((w=g.full)==null?void 0:w.type)==="polygon"?g.full:null;break}default:return null}return g}initializeGraphic(t){return nt()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let n=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(n=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:n,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return nt()}onCursorEdgeChanged(t){return nt()}onVertexAdd(t){var n;se(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||Ci((n=t.vertices.at(0))==null?void 0:n.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){se(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),T.activeEdge):this.removeHandles(T.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),T.outline):this.removeHandles(T.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),T.regularVertices):this.removeHandles(T.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),T.activeVertex):this.removeHandles(T.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(xt)):this._destroyAllVisualizations()}get activeTooltipInfo(){var t;return(t=this._coordinateFormatterLoadTask)!=null&&t.finished?Gt(this._tooltipsContext):null}};a([l()],f.prototype,"_coordinateFormatterLoadTask",void 0),a([l()],f.prototype,"_createOperationGeometry",void 0),a([l()],f.prototype,"_tooltipsContext",null),a([l({value:!0})],f.prototype,"centered",null),a([l()],f.prototype,"cursor",null),a([l({nonNullable:!0})],f.prototype,"defaultZ",void 0),a([l({constructOnly:!0})],f.prototype,"directionOptions",void 0),a([l()],f.prototype,"drawOperation",void 0),a([l()],f.prototype,"elevationLockOnVertexAddDisabled",void 0),a([l({value:!0})],f.prototype,"enabled",null),a([l({value:!0})],f.prototype,"forceUniformSize",null),a([l({constructOnly:!0})],f.prototype,"geometryType",void 0),a([l()],f.prototype,"graphic",null),a([l({constructOnly:!0})],f.prototype,"graphicProperties",void 0),a([l()],f.prototype,"graphicSymbol",null),a([l({constructOnly:!0})],f.prototype,"hasZ",void 0),a([l({constructOnly:!0})],f.prototype,"geometryToPlace",void 0),a([l()],f.prototype,"mode",null),a([l()],f.prototype,"snappingManager",void 0),a([l()],f.prototype,"snapToScene",void 0),a([l()],f.prototype,"tooltip",void 0),a([l()],f.prototype,"tooltipInfos",void 0),a([l({constructOnly:!0,type:Ve})],f.prototype,"sketchOptions",void 0),a([l()],f.prototype,"updating",null),a([l({constructOnly:!0,nonNullable:!0})],f.prototype,"view",void 0),a([l({constructOnly:!0})],f.prototype,"automaticAreaMeasurementUtils",void 0),a([l({constructOnly:!0})],f.prototype,"automaticLengthMeasurementUtils",void 0),a([l({constructOnly:!0})],f.prototype,"undoRedo",null),a([l()],f.prototype,"activeTooltipInfo",null),f=a([S("esri.views.draw.DrawGraphicTool")],f);const xt=Symbol("create-operation-graphic"),T={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Uo(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ji=48,Le="click";let O=class extends Ct{constructor(t){super(t),this.events=new cn,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0}intersectionDistance(t,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};a([l()],O.prototype,"interactive",void 0),a([l()],O.prototype,"selectable",void 0),a([l()],O.prototype,"cursor",void 0),a([l()],O.prototype,"grabbing",void 0),a([l()],O.prototype,"grabbable",void 0),a([l()],O.prototype,"consumesClicks",void 0),a([l()],O.prototype,"grabbableForEvent",void 0),a([l()],O.prototype,"dragging",void 0),a([l()],O.prototype,"hovering",void 0),a([l()],O.prototype,"selected",void 0),O=a([S("esri.views.draw.LegacyDrawManipulator")],O);function qi(e,t){let n=null,i=null;return o=>{if(o.action==="cancel")return void(i!=null&&(i.execute({action:"cancel"}),n=null,i=null));const s={action:o.action,screenStart:o.start,screenEnd:o.screenPoint};o.action==="start"&&n==null&&(n=new Q,i=new Q,t(e,n,i,o.pointerType,s)),n!=null&&n.execute(s),o.action==="end"&&n!=null&&(n=null,i=null)}}function bt(e,t){return e.events.on("drag",qi(e,t))}function Zo(e,t){const n=[e.x,e.y,e.z??0],i=t,o=[Math.cos(i),Math.sin(i)],s=Math.sqrt(o[0]*o[0]+o[1]*o[1]);if(s===0)return null;o[0]/=s,o[1]/=s;const c=r=>{const u=(r.x-n[0])*o[0]+(r.y-n[1])*o[1];r.x=n[0]+u*o[0],r.y=n[1]+u*o[1]};return r=>(c(r.mapStart),c(r.mapEnd),{...r,axis:o})}function Bi(e){let t=null;const n=Ne();return i=>{if(i.action==="start"&&(t=Yi(e,i.mapStart.spatialReference)),t==null)return null;const o=n(i);if(!o)return null;const{translationX:s,translationY:c,translationZ:r}=o;return t.move(s,c,r,i.action),o}}function ae(e,t){return e==null?null:e.spatialReference.equals(t)?e.clone():at(e,t)}function Yi(e,t){const n=e.operations;if(!n)return null;const i=n.data.geometry,o=ri(t);if(i.spatialReference.equals(o))return Pt(e,n,()=>{});if(i.type!=="mesh"){const s=ae(i,o);if(s==null)return null;const c=i.spatialReference,r=Tt.fromGeometry(s,n.viewingMode);return Pt(e,r,()=>{const u=r.data.geometry,p=at(u,c);n.trySetGeometry(p)})}if(si(i)){const s=ae(i.origin,o);if(!s)return null;const c=i.spatialReference,r=Tt.fromGeometry(s,n.viewingMode);return Pt(e,n,()=>{const u=at(r.data.geometry,c),p=u.x-i.origin.x,d=u.y-i.origin.y,m=(u.z??0)-(i.origin.z??0);n.move(p,d,m)})}return null}function Pt(e,t,n){let i=0,o=0,s=0;return{move:(c,r,u,p)=>{var y;p==="start"&&(i=0,o=0,s=0);const d=c-i,m=r-o,v=u-s;t.move(d,m,v),i+=d,o+=m,s+=v,n(),p==="end"&&((y=e.endInteraction)==null||y.call(e))}}}function Ao(e,t=null,n){var c;let i=null;const o=t==null||(c=e.spatialReference)!=null&&c.equals(t)?r=>r:r=>r!=null?at(r,t):r,s={exclude:[],...n};return r=>{if(r.action==="start"&&(i=o(e.toMap(r.screenStart,s))),i==null)return null;const u=o(e.toMap(r.screenEnd,s));return u!=null?{...r,mapStart:i,mapEnd:u}:null}}function Fo(e){const t=e.map(i=>Bi(i)).filter(un),n=Ne();return i=>{const o=n(i);return t.forEach(s=>s(i)),o}}function Wi(e){var n;const t=(n=e.operations)==null?void 0:n.createResetState();return i=>(t==null||t.remove(),i)}function Lo(e){const t=e.map(n=>Wi(n)).filter(n=>n!=null);return n=>(t.forEach(i=>i(n)),n)}function No(){let e=0,t=0,n=0;return i=>{i.action==="start"&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z??0);const o=i.mapEnd.x-e,s=i.mapEnd.y-t,c=(i.mapEnd.z??0)-n;return e=i.mapEnd.x,t=i.mapEnd.y,n=i.mapEnd.z,{...i,mapDeltaX:o,mapDeltaY:s,mapDeltaZ:c,mapDeltaSpatialReference:i.mapStart.spatialReference}}}function Ne(){let e=0,t=0,n=0;return i=>{i.action==="start"&&(e=i.mapStart.x,t=i.mapStart.y,n=i.mapStart.z??0);const o=i.mapEnd.x-e,s=i.mapEnd.y-t,c=(i.mapEnd.z??0)-n;return{...i,translationX:o,translationY:s,translationZ:c}}}function jo(){let e=0,t=0;return n=>{n.action==="start"&&(e=n.screenStart.x,t=n.screenStart.y);const i=n.screenEnd.x-e,o=n.screenEnd.y-t;return e=n.screenEnd.x,t=n.screenEnd.y,{...n,screenDeltaX:i,screenDeltaY:o}}}function qo(e,t){let n=null,i=0,o=0;return s=>{var p;if(s.action==="start"&&(n=(p=e.toScreen)==null?void 0:p.call(e,t),n!=null&&(n.x<0||n.x>e.width||n.y<0||n.y>e.height?n=null:(i=s.screenStart.x-n.x,o=s.screenStart.y-n.y))),n==null)return null;const c=Nt(s.screenEnd.x-i,0,e.width),r=Nt(s.screenEnd.y-o,0,e.height),u=Vt(c,r);return s.screenStart=n,s.screenEnd=u,s}}const Xi=()=>{};class Q{constructor(){this.execute=Xi}next(t,n=new Q){return t!=null&&(this.execute=i=>{const o=t(i);o!=null&&n.execute(o)}),n}}function Ji(e,t,n=[]){if(e.type==="2d")return o=>o;let i=null;return o=>{o.action==="start"&&(i=e.toMap(o.screenStart,{exclude:n}),i!=null&&(i.z=lt(i,e,t)));const s=e.toMap(o.screenEnd,{exclude:n});s!=null&&(s.z=lt(s,e,t));const c=i!=null&&s!=null?{sceneStart:i,sceneEnd:s}:null;return{...o,scenePoints:c}}}function le(e,t,n){const i=t.elevationProvider.getElevation(e.x,e.y,e.z??0,e.spatialReference,"scene")??0,o=pt(e);return o.z=i,o.hasZ=!0,o.z=lt(o,t,n),o}function Bo(e,t){if(e.type==="2d")return i=>i;let n=null;return i=>{i.action==="start"&&(n=le(i.mapStart,e,t));const o=le(i.mapEnd,e,t),s=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...i,scenePoints:s}}}function Qi({predicate:e=()=>!0,snappingManager:t,snappingContext:n,updatingHandles:i,useZ:o=!0}){const s=new Q;if(t==null)return{snappingStep:[ce,s],cancelSnapping:ce};let c,r=null,u=null,p=null;const d=()=>{r=Ot(r),t.doneSnapping(),u==null||u.frameTask.remove(),u=null,c=_e(c),p=null},m=Ki(t,o,s);let v=null,y=null,g=null;return{snappingStep:[_=>{if(!e(_))return _;const{action:P}=_;if(P==="start"){const{info:w}=_,x=to(t.view);if(u=eo(n,_,x),u.context.selfSnappingZ=null,!o&&w!=null){const $=io(n.coordinateHelper,w.handle.part);$!=null&&(u.context.selfSnappingZ={value:$,elevationInfo:n.elevationInfo??Oe})}}if(u!=null){const{context:w,originalScenePos:x,originalPos:$}=u,{mapEnd:E,mapStart:tt,scenePoints:ft}=_,vt=je($,kt(E,tt)),Ht=kt(tt,$),Ye={..._,action:"update"},We=u.context,_t=no(x,ft),Zt=t.update({point:vt,scenePoint:_t,context:w});if(g=Zt,qe(E,Zt,Ht,o),v=vt,y=_t,P!=="end"){const{frameTask:Xe}=u;r==null&&(r=new AbortController),p=Je=>{i.addPromise(St(m({frameTask:Xe,event:Ye,context:We,point:vt,scenePoint:_t,delta:Ht,getLastState:()=>({point:v,scenePoint:y,updatePoint:Je.forceUpdate?null:g})},r.signal)))},p({forceUpdate:!1}),c==null&&(c=I(()=>t.options.effectiveEnabled,()=>p==null?void 0:p({forceUpdate:!0})))}}return P==="end"&&d(),_},s],cancelSnapping:_=>(d(),_)}}function Ki(e,t,n){return be(async({frameTask:i,point:o,scenePoint:s,context:c,event:r,delta:u,getLastState:p},d)=>{const m=await i.schedule(()=>e.snap({point:o,scenePoint:s,context:c,signal:d}),d);if(m.valid){let v=await i.schedule(()=>m.apply(),d);const y=p();y.point!=null&&o!==y.point&&(v=e.update({point:y.point,scenePoint:y.scenePoint,context:c})),y.updatePoint!=null&&X(v,y.updatePoint)||(qe(r.mapEnd,v,u,t),n.execute(r))}})}function to(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(xe.SNAPPING):we}function eo(e,t,n){return{context:new Mt({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:n}}function je(e,[t,n,i]){const o=pt(e);return o.x+=t,o.y+=n,o.hasZ&&(o.z+=i),o}function no(e,t){return e==null||t==null?null:je(e,kt(t.sceneEnd,t.sceneStart))}function kt(e,t){const n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function qe(e,t,[n,i,o],s){e.x=t.x+n,e.y=t.y+i,s&&e.hasZ&&t.hasZ&&(e.z=t.z+o)}function io(e,t){if(!e.hasZ())return null;const n=t.vertices;let i=null;for(const o of n){const s=e.getZ(o.pos);if(i!=null&&s!=null&&Math.abs(s-i)>1e-6)return null;i==null&&(i=s)}return i}function ce(e){return e}let V=class extends Ct{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=be(async(t,n,i,o)=>{const s=this._frameTask;if(s==null)return;const c=await s.schedule(()=>n.snap({...t,context:i,signal:o}),o);c.valid&&await s.schedule(()=>{this.stagedPoint=c.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=n.update({...this._snapPoints,context:i}))},o)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){var t,n;const e=this.view.type==="3d"?(n=(t=this.view)==null?void 0:t.resourceController)==null?void 0:n.scheduler:null;this._frameTask=e!=null?e.registerTask(xe.SNAPPING):we}destroy(){this._abortController=Ot(this._abortController),this._frameTask=_e(this._frameTask)}update(e,t,n){this._snapPoints=e;const{point:i,scenePoint:o}=e,s=t.update({point:i,scenePoint:o,context:n});return this.stagedPoint=s,s}async snap(e,t,n){const{point:i,scenePoint:o}=e;return this.stagedPoint=t.update({point:i,scenePoint:o,context:n}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,n,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=Ot(this._abortController),this._snapPoints=null}};a([l({constructOnly:!0})],V.prototype,"view",void 0),a([l()],V.prototype,"stagedPoint",null),a([l()],V.prototype,"constrainResult",void 0),a([l()],V.prototype,"_stagedPoint",void 0),V=a([S("esri.views.interactive.snapping.SnappingOperation")],V);const oo="crosshair",so="progress",ue=Symbol(),pe=Symbol();let h=class extends ve{constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new oi,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new ge,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=ee(Pi),this._getPolylineOrPolygonConstraint=ee($i),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new Ie,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=Rn(!!e.hasZ))}initializePointer(){var t;const e=(t=this.view.inputManager)==null?void 0:t.latestPointerInfo;e!=null&&this._updatePointer(e.location,e.id,e.type)}initialize(){const{geometryType:e,view:t}=this,n=t.spatialReference,i="viewingMode"in t.state?t.state.viewingMode:2,o=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=Hn(this.hasZ,this.hasM,n),this._editGeometryOperations=new Tt(new Zn(o,this.coordinateHelper),i),this._snappingOperation=new V({view:t}),this.addHandles([I(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:r,constraint:u},p)=>{const{snappingOptions:d}=this;if(d&&(d.forceDisabled=u!=null&&ni(u)),p!=null&&r===p.stagedPoint&&u!==p.constraint)return this._onKeyboardBasedChange();this._processCursor(r??this._screenToMap(this._stagedScreenPoint))},{equals:(r,u)=>r.stagedPoint===u.stagedPoint&&pn(r.constraint,u.constraint)}),I(()=>this.view.viewpoint,(r,u)=>{r&&u&&dn(r,u)&&this._onKeyboardBasedChange()})]),this._activePart=new An(n,i),this._editGeometryOperations.data.parts.push(this._activePart);const s=this.segmentLabels;s!=null&&(s.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils},this.addHandles(I(()=>this.labelOptions.enabled,r=>{s.visible=r},st))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],r=>{var y,g,_,P;const u=r.vertices.map(w=>({componentIndex:0,vertexIndex:w.index,coordinates:this.coordinateHelper.vectorToArray(w.pos)})),p=u.map(w=>w.coordinates),d=this.coordinateHelper.vectorToDehydratedPoint((y=this._activePart.getFirstVertex())==null?void 0:y.pos)??null;X(d,this.firstVertex)||(this.firstVertex=d);const m=this.coordinateHelper.vectorToDehydratedPoint((g=this._activePart.getLastVertex())==null?void 0:g.pos)??null;X(m,this.lastVertex)||(this.lastVertex=m);const v=this.coordinateHelper.vectorToDehydratedPoint((P=(_=this._activePart.segments.at(-1))==null?void 0:_.leftVertex)==null?void 0:P.pos)??null;switch(X(v,this.secondToLastVertex)||(this.secondToLastVertex=v),this._processCursor(this.cursorVertex),r.type){case"vertex-add":this.emit(r.type,{...r,added:p,vertices:u});break;case"vertex-update":this.emit(r.type,{...r,updated:p,vertices:u});break;case"vertex-remove":this.emit(r.type,{...r,removed:p,vertices:u})}}));const c=this._manipulator=new O({consumesClicks:!1,grabbableForEvent:r=>this.drawingMode!=="click"||r.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(c),c.grabbable=e!=="point"&&e!=="multipoint",this.addHandles([c.events.on("immediate-click",r=>this._onImmediateClick(r)),c.events.on("immediate-double-click",r=>this._onImmediateDoubleClick(r)),I(()=>this.drawingMode,()=>{this.removeHandles(ue),this.addHandles(this._createManipulatorDragPipeline(c),ue)},st),I(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:r})=>{c.cursor=r},st)]),ii(this,()=>{var p;const r=((p=this.view.inputManager.latestPointerInfo)==null?void 0:p.type)??"mouse",u=this._getSnappingContext(r);if(this.snappingManager!=null){const d=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,u);this._updatingHandles.addPromise(St(d))}})}destroy(){U(this.segmentLabels),U(this._snappingOperation),this._editGeometryOperations=U(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activePart.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":case"multipoint":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??Le)}get effectiveCursor(){return this.loading?so:this._hideDefaultCursor?null:this.cursor||oo}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activePart.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:n,geometryType:i}=this;return i==="polygon"&&wt(e,n)||wt(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:n}=this,i=e.slice();return t!=null&&i.push(n.pointToArray(t)),i}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e),this._activePart)}complete(e){var s;const t=(e==null?void 0:e.aborted)||!1;this._snappingOperation.abort(),(s=this.snappingManager)==null||s.doneSnapping();const{geometryType:n,numCommittedVertices:i}=this,o=n==="multipoint"&&i===0||n==="polyline"&&i<2||n==="polygon"&&i<3;n!=="segment"&&n!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!o,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((c,r)=>({componentIndex:0,vertexIndex:r,coordinates:c})),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){var c,r;const t=jt(this.cursorVertex),n=jt(e),i=n&&(((c=this._updateAndGetEffectiveDrawSurface())==null?void 0:c.constrainZ(n))??n),o=this._snapToClosingVertex(i),s=this._applyConstraints(o);wt(t,s)||(this._set("cursorVertex",s),(r=this.segmentLabels)==null||r.set("stagedVertex",s!=null?this.coordinateHelper.pointToVector(s):null),s==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activePart.vertices.length,coordinates:this.coordinateHelper.pointToArray(s)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const n=this._activePart;return this._vertexWithinPointerDistance(n.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(n.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return bt(e,(t,n,i,o)=>{const s=o==="touch"&&this._snappingEnabled;if(this.isCompleted||!s)return;const{snappingStep:c,cancelSnapping:r}=Qi({predicate:()=>s,snappingManager:this.snappingManager,snappingContext:new Mt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:o,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});i=i.next(u=>(s&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),u)).next(r),n.next(this._screenToMapDragEventStep()).next(u=>(u.action==="start"&&(this._processCursor(u.mapStart),(this.geometryType==="segment"||s&&!this.numCommittedVertices)&&this.commitStagedVertex()),u)).next(Ji(this.view,this.elevationInfo)).next(...c).next(u=>(s&&(this._processCursor(u.mapEnd),u.action==="end"&&this.commitStagedVertex()),u)).next(u=>(u.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),u))})}_createManipulatorDragPipelineFreehand(e){return bt(e,(t,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(i.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return i})})}_createManipulatorDragPipelineHybrid(e){return bt(e,(t,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(i=>(i.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),pe),this._processCursor(i.mapStart),this.commitStagedVertex()),i)).next(i=>{switch(i.action){case"start":case"update":this._processCursor(i.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(pe),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return i})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:n,numCommittedVertices:i}=this;return e?t!=null||n==="segment"&&i>0:(n==="segment"||n==="polygon")&&i>0}_updateAndGetEffectiveDrawSurface(){var u;const{constraintsEnabled:e,coordinateHelper:t,drawSurface:n,elevationDrawSurface:i,snapToSceneEnabled:o}=this;if(i==null)return n;if(!this.hasZ)return i.defaultZ=null,i;const s=(u=this.elevationInfo)==null?void 0:u.mode;let c=this.defaultZ,r=e||s==="absolute-height";return o!=null&&(r=o),s==="on-the-ground"&&(r=!1),this._drawAtFixedElevation&&(c=(e?this.constraintZ:null)??t.getZ(this._activePart.vertices[0].pos),r=!1),r?n:(i.defaultZ=c,i)}_mapToScreen(e){var t;return(t=this._updateAndGetEffectiveDrawSurface())==null?void 0:t.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:t,geometryType:n}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const i=this._screenToMap(e.screenPoint);if(i==null||i==null||t==="freehand"&&n!=="point"&&n!=="multipoint")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(i),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(t==="freehand"&&this.geometryType!=="multipoint"||n==="point"||n==="segment"&&this.numCommittedVertices===2||n==="segment"&&t==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=Vt(e.x,e.y);this._updatePointer(t,e.pointerId,e.pointerType)&&e.stopPropagation()}_updatePointer(e,t,n){return this._stagedScreenPoint=e,this._stagedPointerType=n,this._stagedPointerId=t,this._isDragging?(this._snappingOperation.abort(),!1):(this._processCursorMovementRelativeToSurface(e,n),!0)}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){var r;const n=this._snappingOperation,i=this._screenToMap(e),o=this._requiresScenePoint?(r=this.drawSurface)==null?void 0:r.screenToMap(e):null;if(i==null)return this._hideDefaultCursor=!0,this._processCursor(null),void n.abort();this._hideDefaultCursor=!1;const s=this.snappingManager;if(s==null)return this._processCursor(i),void n.abort();const c=this._getSnappingContext(t);this._updatingHandles.addPromise(St(n.snap({point:i,scenePoint:o},s,c)))}_applyConstraints(e){const{_constraint:t,constraints:n}=this;if(!e||!n||!t)return e;const{context:i}=n,o=gt(e,i),s=o?t.closestTo(o):void 0;if(!s)return e;const c=Si(s,e,i),r=this.view.type==="2d"||i.elevationInfo.mode!=="absolute-height";return c!=null&&r&&this.constraintZ!=null&&this.hasZ&&(c.z=this.constraintZ),c}_screenToMap(e){var t;return e?(t=this._updateAndGetEffectiveDrawSurface())==null?void 0:t.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action==="start"&&(e=this._screenToMap(t.screenStart)),e==null)return null;const n=this._screenToMap(t.screenEnd);return n!=null?{...t,mapStart:e,mapEnd:n}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return i!=null&&ro(i,t,25)}_getSnappingContext(e){var n;const t=this._drawAtFixedElevation?(n=this.elevationDrawSurface)==null?void 0:n.defaultZ:null;return new Mt({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t!=null?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function ro(e,t,n){const i=e.x-t.x,o=e.y-t.y;return i*i+o*o<=n}a([l()],h.prototype,"_hideDefaultCursor",void 0),a([l()],h.prototype,"_stagedPointerId",void 0),a([l()],h.prototype,"_isDragging",null),a([l()],h.prototype,"_snappingOperation",void 0),a([l()],h.prototype,"_snappingEnabled",null),a([l({constructOnly:!0})],h.prototype,"graphic",void 0),a([l()],h.prototype,"constraintsEnabled",void 0),a([l()],h.prototype,"constraints",void 0),a([l()],h.prototype,"_constraint",null),a([l()],h.prototype,"constraintZ",void 0),a([l()],h.prototype,"defaultZ",void 0),a([l()],h.prototype,"isDraped",void 0),a([l({constructOnly:!0})],h.prototype,"automaticLengthMeasurementUtils",void 0),a([l({value:Le})],h.prototype,"drawingMode",null),a([l({constructOnly:!0})],h.prototype,"elevationDrawSurface",void 0),a([l({constructOnly:!0})],h.prototype,"elevationInfo",void 0),a([l({constructOnly:!0,type:Ie})],h.prototype,"labelOptions",void 0),a([l({constructOnly:!0})],h.prototype,"geometryType",void 0),a([l({constructOnly:!0})],h.prototype,"hasM",void 0),a([l({constructOnly:!0})],h.prototype,"hasZ",void 0),a([l()],h.prototype,"cursor",void 0),a([l()],h.prototype,"effectiveCursor",null),a([l()],h.prototype,"loading",void 0),a([l({constructOnly:!0})],h.prototype,"manipulators",void 0),a([l({constructOnly:!0})],h.prototype,"drawSurface",void 0),a([l({constructOnly:!0})],h.prototype,"segmentLabels",void 0),a([l({constructOnly:!0})],h.prototype,"snappingManager",void 0),a([l({constructOnly:!0})],h.prototype,"snappingVisualizer",void 0),a([l()],h.prototype,"snapToSceneEnabled",void 0),a([l({readOnly:!0})],h.prototype,"cursorVertex",null),a([l({readOnly:!0})],h.prototype,"visualizationCursorVertex",null),a([l()],h.prototype,"committableVertex",null),a([l()],h.prototype,"firstVertex",void 0),a([l()],h.prototype,"lastVertex",void 0),a([l()],h.prototype,"secondToLastVertex",void 0),a([l()],h.prototype,"updating",null),a([l({constructOnly:!0})],h.prototype,"view",void 0),h=a([S("esri.views.draw.DrawOperation")],h);class Yo{constructor(t,n,i,o=null){this._elevationInfo=t,this.defaultZ=n,this._view=i,this._excludeGraphics=o}screenToMap(t){const{defaultZ:n,_view:i}=this,o=i.sceneIntersectionHelper.intersectElevationFromScreen(hn(t.x,t.y),this._elevationInfo,n??0,this._excludeGraphics);return n==null&&o!=null&&(o.z=void 0),o}mapToScreen(t){const n=Rt(t.x,t.y,Se(this._view,t,this._elevationInfo),t.spatialReference);return this._view.toScreen(n)}constrainZ(t){const{defaultZ:n}=this;return n!=null&&t.z!==n&&((t=pt(t)).z=n),t}}class Wo{constructor(t,n,i=[]){this.view=t,this.elevationInfo=n,this.exclude=i}screenToMap(t){const n=this.view.toMap(t,{exclude:this.exclude,excludeLabels:!0});return n!=null&&(n.z=lt(n,this.view,this.elevationInfo)),n}mapToScreen(t){let n=t;return this.elevationInfo!=null&&(n=Rt(t.x,t.y,Se(this.view,t,this.elevationInfo),t.spatialReference)),this.view.toScreen(n)}constrainZ(t){return t}}let Xo=class{constructor(t,n=!1,i=0){this.view=t,this.hasZ=n,this.defaultZ=i,this.mapToScreen=o=>t.toScreen(o),this.screenToMap=n?o=>{const s=t.toMap(o);return s.z=i,s}:o=>t.toMap(o)}constrainZ(t){const{defaultZ:n}=this;return this.hasZ&&t.z!==n&&((t=pt(t)).z=n),t}};const ct=class ct{screenToMap(t){const{x:n,y:i}=t;return new fe({x:n,y:i,spatialReference:ct.spatialReference})}mapToScreen(t){return Vt(t.x,t.y)}constrainZ(t){return t}};ct.spatialReference=new ye;let de=ct;function Qo(e,t){return Be(e,t,!1)}function Ko(e,t){return Be(e,t,!0)}function Be(e,t,n){if(e instanceof Fn){if(e.operation instanceof Ln)return ao(e.operation,t,n),!0;if(e.operation instanceof Nn)return lo(e.operation,t,n),!0;if(e.operation instanceof jn)return co(e.operation,t,n),!0}return!1}function ao(e,t,n=!1){const i=n?-1:1,o=vn(i*e.dx,i*e.dy,i*e.dz);rt(t.origin,t.origin,o),ht(t)}function lo(e,t,n=!1){const i=n?-e.angle:e.angle;Yt(t.basis1,t.basis1,Wt,i),Yt(t.basis2,t.basis2,Wt,i),ht(t)}function co(e,t,n=!1){const i=n?1/e.factor1:e.factor1,o=n?1/e.factor2:e.factor2;Xt(t.basis1,t.basis1,i),Xt(t.basis2,t.basis2,o),Jt(t.origin,t.origin,e.origin,e.axis1,i),Jt(t.origin,t.origin,e.origin,e.axis2,o),ht(t)}function ts(e,t,n,i,o=!1){i||(i=li());const s=L(N.get(),e[1],-e[0]),c=L(N.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=L(N.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),u=N.get(),p=t.allVerticesUnordered;p.forEach(({pos:y})=>{L(u,qt(e,y),qt(s,y)),gn(c,c,u),mn(r,r,u)});const d=1e-6,m=L(N.get(),r[0]-c[0]<d?n/2:0,r[1]-c[1]<d?n/2:0);yn(c,c,m),fn(r,r,m);const v=o?p.reduce((y,g)=>y+(g.pos[2]??0),0)/p.length:0;return Bt(i.basis1,e,(r[0]-c[0])/2),Bt(i.basis2,s,(r[1]-c[1])/2),me(i.origin,c[0]*e[0]+c[1]*s[0],c[0]*e[1]+c[1]*s[1],v),rt(i.origin,i.origin,i.basis1),rt(i.origin,i.origin,i.basis2),ht(i),i}export{f as A,Q as D,Ao as E,Uo as M,qo as R,ts as S,Ko as T,Ji as U,Qo as V,h as a,jo as b,Yo as c,Fo as d,Qi as e,Bi as f,Wi as g,Xo as h,Wo as l,Zo as m,bt as p,Bo as q,b as r,Lo as v,No as z};
